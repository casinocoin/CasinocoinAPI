<?xml version="1.0" encoding="UTF-8"?>
<sequence name="updateAlcurEX" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
  <property name="RESPONSE" scope="default" type="STRING" value="false"/>
  <property description="AlcurEXInfo" name="AlcurEXExchangeID"
    scope="default" type="STRING" value="ALCUREX"/>
  <property action="remove" description="NO_ENTITY_BODY"
    name="NO_ENTITY_BODY" scope="axis2"/>
  <call>
		<endpoint>
			<http method="get" uri-template="https://alcurex.org/api/market.php?pair=CSC_BTC&amp;price=buy">
				<timeout>
					<duration>10000</duration>
					<responseAction>discard</responseAction>
				</timeout>
			</http>
		</endpoint>
	</call>
  <property description="LastBidPriceBTC"
    expression="json-eval($.CSC_BTC[0].price)"
    name="AlcurEXLastBidPriceBTC" scope="default" type="STRING"/>
  <property action="remove" description="NO_ENTITY_BODY"
    name="NO_ENTITY_BODY" scope="axis2"/>
  <call>
        <endpoint>
            <http method="get" uri-template="https://alcurex.org/api/market.php?pair=CSC_BTC&amp;price=sell">
                <timeout>
                    <duration>10000</duration>
                    <responseAction>discard</responseAction>
                </timeout>
            </http>
        </endpoint>
    </call>
  <property description="LastAskPriceBTC"
    expression="json-eval($.CSC_BTC[0].price)"
    name="AlcurEXLastAskPriceBTC" scope="default" type="STRING"/>
  <property action="remove" description="NO_ENTITY_BODY"
    name="NO_ENTITY_BODY" scope="axis2"/>
  <call>
        <endpoint>
            <http method="get" uri-template="https://alcurex.org/api/market.php?pair=CSC_BTC&amp;last=last">
                <timeout>
                    <duration>10000</duration>
                    <responseAction>discard</responseAction>
                </timeout>
            </http>
        </endpoint>
    </call>
  <property description="LastPriceBTC"
    expression="json-eval($.CSC_BTC.price)" name="AlcurEXLastPriceBTC"
    scope="default" type="STRING"/>
  <property action="remove" description="NO_ENTITY_BODY"
    name="NO_ENTITY_BODY" scope="axis2"/>
  <call>
        <endpoint>
            <http method="get" uri-template="https://alcurex.org/api/market.php?currency=CSC&amp;interval=24&amp;pair=CSC_BTC">
                <timeout>
                    <duration>10000</duration>
                    <responseAction>discard</responseAction>
                </timeout>
            </http>
        </endpoint>
    </call>
  <property description="Volume24H"
    expression="json-eval($.tradeamount)" name="AlcurEXVolume24H"
    scope="default" type="STRING"/>
  <payloadFactory description="CreateDBPayload" media-type="xml">
    <format>
      <p:updateExchangeInfo xmlns:p="org.casinocoin.public.api.dss">
        <xs:LastBidPriceBTC xmlns:xs="org.casinocoin.public.api.dss">$1</xs:LastBidPriceBTC>
        <xs:LastAskPriceBTC xmlns:xs="org.casinocoin.public.api.dss">$2</xs:LastAskPriceBTC>
        <xs:LastPriceBTC xmlns:xs="org.casinocoin.public.api.dss">$3</xs:LastPriceBTC>
        <xs:Volume24H xmlns:xs="org.casinocoin.public.api.dss">$4</xs:Volume24H>
        <xs:ShortName xmlns:xs="org.casinocoin.public.api.dss">$5</xs:ShortName>
      </p:updateExchangeInfo>
    </format>
    <args>
      <arg evaluator="xml" expression="$ctx:AlcurEXLastBidPriceBTC"/>
      <arg evaluator="xml" expression="$ctx:AlcurEXLastAskPriceBTC"/>
      <arg evaluator="xml" expression="$ctx:AlcurEXLastPriceBTC"/>
      <arg evaluator="xml" expression="$ctx:AlcurEXVolume24H"/>
      <arg evaluator="xml" expression="$ctx:AlcurEXExchangeID"/>
    </args>
  </payloadFactory>
  <property action="remove" name="REST_URL_POSTFIX" scope="axis2"/>
  <property name="HTTP_METHOD" scope="axis2" type="STRING" value="POST"/>
  <call>
    <endpoint key="UpdateExchangeInfoEndpoint"/>
  </call>
  <drop description="End"/>
</sequence>
